!function(a){"use strict";var b;b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.regionselector.defaults,c),this.$element.addClass("regionselector"),this.regions=[],this.cache=null,this.regionGroup=this.$element.data("regiongroup"),this.init(),this.listen()},b.prototype={constructor:b,init:function(){var b=this.$element.data("region");this.regions=a.uls.data.getRegionsInGroup(this.regionGroup),b&&this.regions.push(b)},test:function(b){var c,d,e=a.uls.data.getRegions(b);for(d=0;d<this.regions.length;d++)if(c=this.regions[d],a.inArray(c,e)>=0)return this.render(b,c),void(this.cache[b]=c)},show:function(){var b,c,d,e,f,g=this.options.$target&&this.options.$target.$element,h=g&&g.parent(),i=g&&g.prev();if(g&&h&&g.detach(),this.cache){b=null;for(b in this.cache)this.render(b,this.cache[b])}else{this.cache={},c=a.uls.data.getLanguagesByScriptGroup(this.options.languages);for(d in a.uls.data.scriptgroups)if(e=c[d])for(e.sort(a.uls.data.sortByAutonym),f=0;f<e.length;f++)this.test(e[f])}g&&h&&(i?i.after(g):h.append(g)),this.options.success&&this.options.success(this)},render:function(a,b){var c=this.options.$target;c&&c.append(a,b)},listen:function(){this.$element.on("click",a.proxy(this.click,this))},click:function(){this.$element.hasClass("active")||(this.options.$target.empty(),this.show(),a(".regionselector").removeClass("active"),this.regionGroup&&this.$element.addClass("active"))}},a.fn.regionselector=function(c){return this.each(function(){var d=a(this),e=d.data("regionselector"),f="object"==typeof c&&c;e||d.data("regionselector",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.regionselector.defaults={$target:null,success:null,noresults:null,languages:null},a.fn.regionselector.Constructor=b}(jQuery);